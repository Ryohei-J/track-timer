# プロジェクト概要

ポモドーロタイマーとDJターンテーブルUIを組み合わせたNext.jsベースのWebアプリケーション。ユーザーは「作業」と「休憩」のセッションに異なる音楽ソース（主にYouTubeのURL）を割り当て、タイマーの切り替わりに合わせてトラックをシームレスに切り替えることができる。

# コアコンセプト

- **ターンテーブルUI**: 画面に2枚のディスクを表示。左が「作業」、右が「休憩」。
- **オーディオ・コンディショニング**: 音楽を使って精神状態（集中 vs リカバリー）を切り替える。
- **DJスタイルのトランジション**: タイマーがゼロになると、現在のトラックを自動フェードアウトし、次のディスクに切り替える。

# 主要機能（MVP）

- **デュアルデッキ構成**: 各デッキにTime（分）とAudio URL（YouTube）の入力フィールドを配置。
- **タイマーロジック**: 作業/休憩の時間を自由に設定可能（25/5分に固定しない）。
- **自動切替 & ループ**: トラックがタイマーより短い場合はループ再生。デッキ間の自動トランジション。
- **リピートサイクル**: 作業/休憩のセット数を設定可能。
- **ローカル永続化**: 設定（URL/時間）をlocalStorageに保存（初期版ではDB不要）。
- **一時停止**: タイマー一時停止時は音楽も同時に停止する。
- **セッション完了**: 全サイクル終了後は自動停止。
- **ダーク/ライトモード**: 両方に対応する。
- **エラー通知**: 無効なURLや埋め込み不可の動画の場合、ポップアップ/モーダルで別のURLの入力を促す。

# 技術スタック

- **フレームワーク**: Next.js（App Router）
- **パッケージマネージャ**: pnpm
- **スタイリング**: Tailwind CSS
- **アニメーション**: Framer Motion（ディスクの回転やクロスフェード用）
- **状態管理**: React Hooks（useState, useEffect）
- **API**: YouTube IFrame Player API（MVP）。今後フリー音源配信サイトに順次対応。
- **永続化**: localStorage
- **デプロイ**: Vercel
- **テスト**: 最低限のテストを実装

# 実装の詳細と制約

- **自動再生**: ブラウザの自動再生制限を回避するため、最初のユーザー操作（スタートボタン）時に両プレーヤーを初期化する必要がある。
- **フェーディング**: セッション終了前の最後の5秒間にsetVolumeによるボリューム漸減を実装する。
- **表示要件**: YouTube Playerは利用規約に準拠するため、小さくても画面上に表示し続ける必要がある。
- **No-DBポリシー**: 初期版ではすべてのユーザー設定をクライアント側に保存する。
- **タイマー精度**: バックグラウンドタブでのスロットリング対策として、`Date.now()`ベースの経過時間計算を採用する。
- **レスポンシブ**: 基本はデスクトップ使用を想定。最低限のモバイル対応を行う。
- **通知音（サウンドオーバーレイ）**: MVP時点では対応しない。将来的に追加を検討。

# 開発フェーズ

## Phase 1: プロジェクト基盤 & コア機能
プロジェクトのスキャフォールド（pnpm + Next.js + Tailwind CSS + Framer Motion）と、タイマーロジックの実装。作業/休憩の時間設定、カウントダウン、セッション自動切替、リピートサイクル、一時停止/再開を動作させる。

## Phase 2: YouTube再生 & デュアルデッキ制御
YouTube IFrame Player APIを統合し、2つのデッキそれぞれで動画を再生できるようにする。セッション切替時の自動フェードアウト/フェードイン、ループ再生、URL入力と無効URL時のエラーモーダルを実装する。

## Phase 3: 永続化 & 設定管理
localStorageによるユーザー設定の保存・復元。URL、時間設定、リピート回数などをブラウザに記憶させる。

## Phase 4: ターンテーブルUI
2枚の回転ディスクのビジュアル実装。再生中のディスク回転アニメーション、アクティブデッキのハイライト、DJスタイルのトランジション演出。

## Phase 5: テーマ & UIブラッシュアップ
ダーク/ライトモード切替の実装。レスポンシブ対応の調整、全体的なレイアウトやビジュアルの仕上げ。
